<div class="row">
  <h1>Clients</h1>
</div>

<div class="row">
  <table class="table table-condensed">
    <thead>
      <tr>
        <th>Client</th>
        <th>Revenue (Invoiced)</th>
        <th>Effective Rate</th>
        <th>Gross Cost</th>
        <th>Gross Profit</th>
      </tr>
    </thead>
    <tbody>
      <% @clients_key_metrics.each do |client_key_metrics| %>
        <% next unless client_key_metrics.client_invoices.any? %>   
        <tr>
          <td><%= client_key_metrics.client.name %></td>
          <td><%= number_to_currency(client_key_metrics.revenue, precision: 0) %></td>
          <td><%= number_to_currency(client_key_metrics.effective_rate, precision: 0) %></td>
          <td><%= number_to_currency(client_key_metrics.gross_cost, precision: 0) %></td>
          <td><%= number_to_currency(client_key_metrics.gross_profit, precision: 0) %></td>
        </tr>
      <% end %>
      <tr>
        <td><strong>Total</strong></td>
        <td><strong><%= number_to_currency(@key_metrics.revenue, precision: 0) %><strong></td>
        <td><strong><%= number_to_currency(@key_metrics.effective_rate, precision: 0) %><strong></td>
        <td><strong><%= number_to_currency(@clients_key_metrics.map(&:gross_cost).sum, precision: 0) %><strong></td>
        <td><strong><%= number_to_currency(@clients_key_metrics.map(&:gross_profit).sum, precision: 0) %><strong></td>
      </tr>
    </tbody>
  </table>
</div>